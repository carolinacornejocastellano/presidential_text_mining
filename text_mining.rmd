---
title: "_Palabras que se las lleva el viento_"
subtitle: "Exploring presidential inauguration speeches of the last decade"
output: html_document
date: \today
bibliography: ["C:/Users/Carolina/Documents/0cast/biblatex.bib"]
link-citations: true
lang: en-US
linkReferences: true
nameInLink: true
---

## Introduction

As of this writing, the current Peruvian government counts over 66 deaths in just 3 months of government [@rebazaTheySayWe2023]. Dina Boluarte is Peru’s first female president and the sixth person to occupy the presidential chair in four years [@olmoPresidentesAnosPor2022]. She ascended to office on December 7, 2022, after the previous president, elected by popular vote, dissolved the congress after only 16 months in charge and many attempts of being removed from office by Congress.

The analysis of the political motives of the perpetual Peruvian political crisis exceeds the purpose of this exercise. However, it will suffice to mention that, before Boluarte, perhaps the one who aroused the most popular rage was Manuel Merino, who governed alone from November 10 to 15, 2020 —less than a week!— and ended up resigning because of massive protests throughout the country [@redaccionbbcnewsmundoOlaProtestasPeru2020]. The last government that lasted 5 years, the constitutional term of office, was that of Ollanta Humala (2011 - 2016). Since then, mandates have lasted months or even just days. 

This exercise aims to characterize the topics and sentiments addressed in the first Message to the Nation (or inaugural speech) of each of the last 10 presidents. The hypothesis is that their inaugural speeches, analyzed through text mining techniques, will help to characterize the context in which they ascended to power, and that there will be clear differences in the topics, length and sentiments of those who ascended by popular vote, and those who took office by emergency succession.

## Data

The speeches were manually downloaded in .pdf format from official sources: the archive of the [Congress of the Republic of Peru](https://www.congreso.gob.pe/participacion/museo/congreso/mensajes-presidenciales/) and the [Single Digital Platform of the Peruvian State](https://www.gob.pe/mensajepresidencial]). Only the inaugural speech of Alan Garcia (2006-2011) was not found, as the one of Alejandro Toledo (2001-2006) was wrongly uploaded in its place. Therefore, to complete 10 presidents, the speech of the first period of government of the dictator Alberto Fujimori (1900 - 1995) was also extracted.

These pdf were then converted to markdown, superficially checked for special characters, and uploaded to GitHub so that we could retrieve them directly from there and make this exercise reproducible without the need to attach them. The GitHub repository is accessible [here](https://github.com/carolinacornejocastellano/presidential_text_mining). 


Thus, we will work with 10 presidential messages, proclaimed on the following dates:

- Dina Boluarte (December 7, 2022).
- Pedro Castillo (December 28, 2021)
- Francisco Sagasti (November 17, 2020)
- Martin Vizcarra (March 23, 2018).
- Pedro Pablo Kuczynski (July 28, 2016).
- Ollanta Humala (July 28, 2011)
- Alejandro Toledo (July 28, 2001)
- Valentín Paniagua (November 11, 2000)
- Alberto Fujimori (second term) (July 28, 1995)
- Alberto Fujimori (first term) (July 28, 1990)

Of these, Dina Boluarte, Francisco Sagasti, Martín Vizcarra and Valentín Paniagua were not elected by popular vote, but were assigned for different reasons and in different contexts, with different popular approval. There is also a debate about Alberto Fujimori's second term, whether he was legitimately elected or manipulated the results in obedience to his dictatorial spirit. On the other hand, Manuel Merino was not purposely considered: because of the way he took office and his brief period, many do not consider him a president, only a coup plotter or usurper. 

## Dataframe creation

```{r}
libraries <- c(
  "tidyverse",
  "tidytext",
  "textdata",
  "wordcloud",
  "RColorBrewer",
  "reshape2",
  "igraph",
  "ggraph",
  "widyr",
  "tm",
  "quanteda",
  "quanteda.textplots",
  "topicmodels",
  "syuzhet",
  "parallel",
  "textstem",
  "SentimentAnalysis"
)

# install (in case they are not already installed) and load packages
for (lib in libraries) {
  if (!requireNamespace(lib, quietly = TRUE)) {
    install.packages(lib)
  }
  suppressPackageStartupMessages(library(lib, character.only = TRUE))
}

# remove vector and iterator
rm(lib, libraries)
```

The speeches were downloaded from the GitHub repository. The following steps are to automatically create the download link for each given the username and repository name:

```{r download speeches}
presidents <-
  c("Dina Boluarte", 
    "Pedro Castillo", 
    "Francisco Sagasti", 
    "Martin Vizcarra", 
    "Pedro Pablo Kuczynski", 
    "Ollanta Humala", 
    "Alejandro Toledo", 
    "Valentin Paniagua", 
    "Alberto Fujimori second term", 
    "Alberto Fujimori first term")

links <- paste0(
  "https://raw.githubusercontent.com/carolinacornejocastellano/presidential_text_mining/main/",
  tolower(gsub(" ", "_", presidents)), ".md")
```

Then, the dataframe was created:
```{r create df}
df <- tibble(
  president = presidents,
  date = c("2022-12-07", 
          "2021-07-28", 
          "2020-11-17", 
          "2018-03-23", 
          "2016-07-28",
          "2011-07-28", 
          "2001-07-28", 
          "2000-11-11", 
          "1995-07-28",
          "1990-07-28"), 
  url = links
)
```

And then we download the speeches. In this way, we will obtain a dataframe with 3 columns: president, date of the speech and the entire speech, in a single line for each president:

```{r read speeches}
df$speech <- df$url %>% 
    map_chr(~ read_lines(.x, 
      locale = locale(encoding = "UTF-8")) %>% 
        paste(collapse = "\n"))

# delete URLs' column from df, as they are not longer needed
df$url <- NULL

head(df)
```

## Data preparation

Now we will tokenize the speeches and remove stopwords. Since the language of the speeches is Spanish, we chose to conduct the analysis in Spanish. We considered that translating them could add a degree of bias, since many online translation services perform very literal translations and/or make the real meaning of what was said at the time get lost. 

However, as we will see later on, analyzing the Spanish texts was a challenge in itself, since the stopwords, sentiment analysis, lemmatization and stemming packages, etc., are mostly built for English corpora. In some cases, we had to add additional parameters or use other packages to do the same as what we learned in the classes with English texts. 

Next, to remove the English stopwords, we store them in a vector. Then, we split the column of speechs into tokens with the `unnest_tokens()` function from the `tidytext` package. Subsequently, we removed those tokens that matched the stopwords stored in the vector.

```{r store stopwords in Spanish as a vector}
stopwords_es <- stopwords::stopwords("es",
  source = "stopwords-iso"
)
```

```{r delete stopwords from the original df}
df_no_stopwords <- df %>%
  unnest_tokens(word, speech) %>%
  anti_join(data.frame(word = stopwords_es),
            by = "word") %>%
  group_by(president, date) %>%
  summarize(clean_speech = paste(word,
                                 collapse = " "))
```

```{r}
df_tokenized <- df_no_stopwords %>% 
  unnest_tokens(word, clean_speech) %>% 
  filter(!word %in% stopwords_es)
```

Below we can see which were the most used words in a given speech, and which president used them the most. It can be seen that Pedro Pablo Kuczynski (PPK) leads the ranking, mentioning the common place _país_ (country) 32 times in his speech. Pedro Castillo also used that word repeatedly. This is interesting because both come from totally different political -and personal- spectrums: PPK, of Polish origin and upper income class, has been in Peruvian politics for decades: is an economist, businessman and former Minister of Economy, and a neoliberal who studied all his degrees in US and UK universities. On the other hand, Pedro Castillo, from the conservative left, was a rural school teacher in Cajamarca, one of the poorest regions of Peru, with no experience as a politician. Both mentioned _país_ (country) repeatedly. Regarding a word that can give us an idea of the priorities of a president at the beginning of his government, in the case of Pedro Castillo, the word _salud_ (health) was repeated 28 times. This makes sense, since he took office at a time when the Covid-19 pandemic was still killing thousands of people in Peru.  It is clear that public health policies were an important theme in his first speech.

Another case worth mentioning is the reference to the word _pueblo_ (town, nation or working class) in the inauguration of the second term of dictator Alberto Fujimori. He also mentioned _desarrollo_ (development) a lot and, towards the fourth tab of results, it is seen that he mentioned _derechos_ (rights) and _humanos_ (human) 12 times. It is peculiar because he is now facing sentences, among other reasons, for systematic violations of human rights. For example, his "family planning" policies, which consisted of forced sterilization of women in the poorest and most remote areas of Peru, often Quechua-speaking, were among his most notorious cases. In his fight against terrorism, he also ordered innocent and poor people to be killed massively for being "suspects".

```{r general word ranking}
df_tokenized %>%
  count(word,
    sort = TRUE
  )
```

Below is a graph representing the most used words by each president. Specifically, those words used more than 7 times are shown. For that reason, some presidents —Valentín Paniagua and Dina Boluarte— are not shown. This is to be expected, because they took office by emergency: it is understandable that they did not have a speech as extensive and prepared as those elected by popular vote. Even Francisco Sagasti and Martin Vizcarra, who are included in the graph, are the two who show the fewest words above 7 repetitions among all the others: they also took office on an emergency basis, with only a few hours' pre-notification.

```{r plot the most common words in presidential speeches}
df_tokenized %>% 
  count(president, 
    word, 
    sort = TRUE
  ) %>% 
  filter(n > 7) %>% # words that each president used more than 7 times
  ggplot(aes(x = reorder(word, n), 
            y = n, 
            fill = president)) +
  geom_col() +
    facet_wrap(~president, 
    scales = "free") +
    coord_flip() +
    scale_fill_manual(values = brewer.pal(8, "BrBG")) +
    theme_minimal() +
    ggtitle("Most Common Words in Presidential Inauguration Speeches", 
            subtitle = "From 1990 to 2022") +
    labs(
      x = "Word",
      y = "Frequency", 
      fill = "President"
    ) +
    theme(
      plot.title = element_text(
        hjust = 0.5,
        size = 20,
        face = "bold"
      ),
      plot.subtitle = element_text(
        hjust = 0.5,
        size = 14
      )
    )
```

## N-grams

We will analyze the most common bigrams. Below the top 20 bigrams can be seen:

```{r most common bigrams in all speeches}
df_no_stopwords %>%
  unnest_tokens(bigram,
                clean_speech,
                token = "ngrams",
                n = 2) %>%
  filter(!is.na(bigram)) %>%
  count(bigram, sort = TRUE) %>% 
  head(20)
```
Similar to what has already been mentioned, the reference to human rights (_derechos humanos_) is constant in the discourse of Alberto Fujimori's second term. Without reading his speech, but knowing in broad terms the reasons for which he is accused, one might think that in his speech he was already defending himself against accusations of human rights violations. 

PPK mentioned the bigrams _año 2021_ (year 2021) and _año Bicentenario_ (Bicentennial year) a lot because, upon taking office in 2016, he was going to be the president to receive the Bicentennial of Peru's Independence on 2021. However, he resigned from office much earlier.

On the other hand, the _asamblea constityente_ Constituent Assembly was Pedro Castillo's main campaign promise to reform the constitution. 

Another important feature is the mention of social issues by the two presidents who took office after running for the left: Ollanta Humala —although he later made a neoliberal right-wing government— and Pedro Castillo. The former spoke repeatedly about _inclusión social_ (social inclusion), and the latter about _protección social_ (social protection).

Below are the top 2 bigrams for each president. However, since there are many bigrams that are repeated an equal number of times, there are many ties in the top 2, so more are actually shown.

```{r}
bigrams <-  df_no_stopwords %>%
  unnest_tokens(bigram, 
                clean_speech, 
                token = "ngrams", 
                n = 2)

# Bigrams by president
bigram_counts <- bigrams %>%
  count(president, 
        bigram, 
        sort = TRUE)

# Top bigrams for each president
top_bigrams <- bigram_counts %>%
  group_by(president) %>%
  top_n(2, n) %>%
  arrange(president)

top_bigrams
```
The following graph shows the most common bigrams. However, the plot does not show well in the inline preview. Please, click in "Show in New window" button for it to be displayed well:

```{r bigrams plot}
ggplot(top_bigrams, 
       aes(x = reorder(bigram, n), 
           y = n, 
           fill = president)) +
  geom_col() +
  facet_wrap(~ president, 
             scales = "free") +
  coord_flip() +
  scale_fill_manual(values = brewer.pal(10, "BrBG")) +
  theme_minimal() +
  ggtitle("Most Common Bigrams in Presidential Speeches", 
          subtitle = "From 1990 to 2022") +
  labs(x = "Bigram", 
       y = "Frequency", 
       fill = "President") +
  theme(plot.title = element_text(hjust = 0.5, 
                                  size = 20, 
                                  face = "bold"),
        plot.subtitle = element_text(hjust = 0.5, 
                                     size = 14))

```
Now, let's take a look to the most common trigrams:

```{r}
df_no_stopwords %>%
  unnest_tokens(trigram,
                clean_speech,
                token = "ngrams",
                n = 3) %>%
  filter(!is.na(trigram)) %>%
  count(trigram, sort = TRUE) %>% 
  head(20)
```

In the case of PPK, references to the year 2021 as the year of the Bicentennial of the Independence of Peru are repeated. However, the theme of _país moderno significa_, alluding to "modernization", is also very present. It could be thought that his allusion to modernization was in response to one of the main criticisms against him during his campaign: that he is an "old school" politician who has been decades without making a significant contribution to the country from his positions in the executive and legislative offices, and that he is too old to assume the presidency. In fact, one of his campaign slogans was _Me hago viejo esperando_ ("I grow old waiting"), responding to criticism about his advanced age. 

By arranging the trigrams by president in alphabetical order, we also get an idea of the general theme of their speeches. Fujimori, who we have already mentioned is in prison for human rights violations, including the forced sterilization of thousands of indigenous, poor and Quechua-speaking women as a method to contain poverty, in his first term spoke about "family planning" and "poverty". In his second term, he spoke about "respect for human rights". Another very important topic in his speech is related to productivity, the role of companies in economic development, the economic crisis of that time and terrorism (when he mentions "the armed groups").

On the contrary, Alejandro Toledo does not show any very relevant trigram, except his mention to the armed and police forces. On the other hand, Dina Boluarte does not have a predominant trigram: all of them are repeated only once.  It is to be anticipated, because she took office with only hours of notice, and, therefore, it is expected that she has not had a very structured speech.  Similar happens with Martin Vizcarra and Valentin Paniagua.

```{r}
trigrams <-  df_no_stopwords %>%
  unnest_tokens(trigram, 
                clean_speech, 
                token = "ngrams", 
                n = 3)

# trigrams by president
trigram_counts <- trigrams %>%
  count(president, 
        trigram, 
        sort = TRUE)

# Top bigrams for each president
top_trigrams <- trigram_counts %>%
  group_by(president) %>%
  top_n(2, n) %>%
  arrange(president)

top_trigrams
```

```{r}
ggplot(top_trigrams, 
       aes(x = reorder(trigram, n), 
           y = n, 
           fill = president)) +
  geom_col() +
  facet_wrap(~ president, 
             scales = "free") +
  coord_flip() +
  scale_fill_manual(values = brewer.pal(10, "BrBG")) +
  theme_minimal() +
  ggtitle("Most Common Trigrams in Presidential Speeches", 
          subtitle = "From 1990 to 2022") +
  labs(x = "Trigram", 
       y = "Frequency", 
       fill = "President") +
  theme(plot.title = element_text(hjust = 0.5, 
                                  size = 20, 
                                  face = "bold"),
        plot.subtitle = element_text(hjust = 0.5, 
                                     size = 14))
```

For that reason, as can be seen in the graph above, their bar graphs are almost unreadable. Thus, the trigram analysis gives us an idea of who took office on an emergency basis.


## Sentiment analysis

We will now perform a sentiment analysis of the speeches. For this purpose, other packages that were not seen in class were used. This is because sentiment analysis assigns a label - of level of polarization or sentiment - to words that are used based on lexicons. However, the packages discussed in class are more intended for use with English corpora. Thus, in this section, after searching and testing with other packages, the packages `syuzhet` and `SentimentAnalysis`, were employed. Yet, they may not be as good as those based on English lexicons, which are much more developed.  

The next chunk may take up to a couple of minutes to run: 

```{r sentiment analysis with `SentimentAnalysis` package}
sentiments_spanish <- analyzeSentiment(df_tokenized$word,
  language = "spanish",
  stemming = TRUE
)
head(sentiments_spanish)
```
The following is to view sentiment direction (i.e. positive, neutral and negative):

```{r}
df_sentiments <- data.frame(df_tokenized$word,
  sentiment = convertToDirection(sentiments_spanish$SentimentGI))
df_sentiments
```

```{r}
table(df_sentiments$sentiment)
```
As can be seen, the vast majority of words were classified as neutral. This includes nouns such as "country", or numbers such as 2021. 


```{r}
df_sentiments %>%
  group_by(sentiment) %>%
  summarise(number = n()) %>% 
  ggplot(aes(x = sentiment,
            y=number)) +
  geom_bar(aes(fill=sentiment),
              stat = "identity") +
  scale_fill_manual(values = brewer.pal(4, "BrBG")) +
  theme_minimal() +
  ggtitle("Most Common Sentiments in Presidential Speeches", 
          subtitle = "From 1990 to 2022, according to the {SentimentAnalysis} package") +
  labs(x = "Sentiment", 
       y = "Frequency", 
       fill = "President") +
  theme(plot.title = element_text(hjust = 0.5, 
                                  size = 20, 
                                  face = "bold"),
        plot.subtitle = element_text(hjust = 0.5, 
                                     size = 14))
```

Now, we will contrast these results with the `syuzhet` package. This package associates texts to 8 emotions and 2 feelings. The more the value exceeds 0, the more pronounced the emotion or feeling is. 

However, we noticed that using this package requires much computational power and takes a long time. For that reason, we freed memory with the `gc()` function and parallelized the process. The parallel computing approach consists of distributing tasks that do not need to be sequential, for them to be executed in a parallel way. Therefore, we can use more than one core —in our case, the laptop on which we performed this exercise has 8 cores— to execute the task. We could potentially parallelize this process on those 8 cores, but in the interest of making this code reproducible, since not every computer has this number of cores, we will use only 4.

We also recommend closing other programs that are not being used.

```{r parallelization}
gc()
cl <- makeCluster(4)
clusterExport(cl = cl, c("get_sentiment", 
                         "get_sent_values", 
                         "get_nrc_sentiment", 
                         "get_nrc_values", 
                         "parLapply"))
```

```{r assign sentiment or emotion to words}
sentiment_nrc <- get_nrc_sentiment(df_tokenized$word, 
                                   cl = cl,
                                   language = "spanish")
stopCluster(cl)
```

In our case, this computation took 1 minute and 40 secs, and almost 95% of CPU.

```{r}
head(sentiment_nrc)
```
Below is an example of 20 words associated with each emotion or feeling. The list is longer, but for space reasons only 20 will be shown. To see the complete list, uncomment the last line of each chunk. 

The order of each emotion or feeling is in alphabetical order: anger, anticipation, disgust, fear, joy, sadness, surprise, trust, negative, positive.

```{r}
anger <- which(sentiment_nrc$anger > 0)
head(df_tokenized$word[anger], 20)
#df_tokenized$word[anger]
```

```{r}
anticipation <- which(sentiment_nrc$anticipation > 0)
head(df_tokenized$word[anticipation], 20)
#df_tokenized$word[anticipation]
```

```{r}
disgust <- which(sentiment_nrc$disgust > 0)
head(df_tokenized$word[disgust], 20)
#df_tokenized$word[disgust]
```

```{r}
fear <- which(sentiment_nrc$fear > 0)
head(df_tokenized$word[fear], 20)
#df_tokenized$word[fear]
```

```{r}
joy <- which(sentiment_nrc$joy > 0)
head(df_tokenized$word[joy], 20)
# df_tokenized$word[joy]
```

```{r}
sadness <- which(sentiment_nrc$sadness > 0)
head(df_tokenized$word[sadness], 20)
# df_tokenized$word[sadness]
```

```{r}
surprise <- which(sentiment_nrc$surprise > 0)
head(df_tokenized$word[surprise], 20)
# df_tokenized$word[surprise]
```

```{r}
trust <- which(sentiment_nrc$trust > 0)
head(df_tokenized$word[trust], 20)
# df_tokenized$word[trust]
```

```{r}
negative <- which(sentiment_nrc$negative > 0)
head(df_tokenized$word[negative], 20)
# df_tokenized$word[negative]
```

```{r}
positive <- which(sentiment_nrc$positive > 0)
head(df_tokenized$word[positive], 20)
#df_tokenized$word[positive]
```

As can be seen below, in an aggregated manner, the "positive" and "trust" words are the most used by Peruvian presidents in recent years, followed by the negative words —although these are almost half of the positive ones—, and the words denoting "fear" and "anticipation": 

```{r}
sentiment_nrc %>%  
  summarise_all(sum) %>% 
  gather(key = sentiment, 
         value = number) %>%
  arrange(desc(number))
```


```{r}
sentiment_nrc %>%  
  summarise_all(sum) %>% 
  gather(key = sentiment, value = number) %>%
  ggplot(aes(x = sentiment, y = number, fill = sentiment)) +
  geom_bar(stat = "identity") +
  scale_fill_manual(values = brewer.pal(10, "BrBG")) +
  theme_minimal() +
  ggtitle("Most Common Sentiments in Presidential Speeches", 
          subtitle = "From 1990 to 2022, according to the {syuzhet} package") +
  labs(x = "Sentiment", y = "Frequency", fill = "Sentiment") +
  theme(plot.title = element_text(hjust = 0.5, size = 20, face = "bold"),
        plot.subtitle = element_text(hjust = 0.5, size = 14))
```


## Latent Dirichlet Allocation

```{#r}
# Create a Document-Term Matrix (DTM)
dtm <- df_tokenized %>%
  count(president, word) %>%
  cast_dtm(president, word, n)

# LDA model with 5 topics
lda_model <- LDA(dtm, k = 5)

# Get the probabilities of words per topic
term_topic_prob <- tidy(lda_model, matrix = "beta")

# Top 10 words per topic
top_terms <- term_topic_prob %>%
  group_by(topic) %>%
  top_n(10, beta) %>%
  ungroup() %>%
  arrange(topic, -beta)

# Assign topics to documents
document_topic_prob <- tidy(lda_model, matrix = "gamma")

# Merge topics with original data
document_topic_merged <- df_no_stopwords %>%
  left_join(document_topic_prob,
    by = c("president" = "document")
  )

# Find the most probable topic for each president
president_topics <- document_topic_merged %>%
  group_by(president) %>%
  top_n(1, gamma) %>%
  select(president, topic)

```
